this.HPWAUTOC||(this.HPWAUTOC={}),function(){function e(e,t,r){return e===t?document.getElementById(e).value+"\n"+r:r}function t(e,t){var r=new XMLHttpRequest;return r.open("GET",e),r.timeout=5e3,r.withCredentials=!0,r.setRequestHeader("Authorization",t),r.setRequestHeader("Content-Type","application/json"),r.setRequestHeader("HPW-AuthError","400"),r}function r(e,t,r,o){e.Debug?o?alert("AutoComplete Error\n\nStatus: "+t+"\nDescription: "+r+"\n\n"+o+"\n\nPlease refresh the page and try again."):alert("AutoComplete Error\n\nStatus: "+t+"\nDescription: "+r+"\n\nPlease refresh the page and try again."):alert("AutoComplete Error\n\nThe address capture feature is currently unavailable. Please refresh the page and try again.")}function o(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function n(e){return void 0!==e.jwt?"Bearer "+e.jwt:"Basic "+e.auth}function a(e){return void 0!==e?e:""}function i(e){return"number"==typeof e&&isFinite(e)&&Math.floor(e)===e&&e>0}function u(t,r){var o,n,i,u,s;for(document.getElementById(t.input).value="",o=1;o<=t.outputlines;o++)(i=t.output["line"+o])&&document.getElementById(i)&&(document.getElementById(i).value=e(i,u,a(r["Label"+o])),u=i);if((i=t.output.country)&&document.getElementById(i)&&(document.getElementById(i).value=e(i,u,a(r.Country))),t.detail)for(n in t.detail)document.getElementById(t.detail[n])&&(r[n]?document.getElementById(t.detail[n]).value=r[n]:document.getElementById(t.detail[n]).value="");if(t.extra&&r.Extra&&r.Extra.Records&&r.Extra.Records.length>0)for(n in s=r.Extra.Records[0],t.extra)document.getElementById(t.extra[n])&&(s[n]?document.getElementById(t.extra[n]).value=s[n]:document.getElementById(t.extra[n]).value="")}HPWAUTOC.FindAddress=function(e){var a="",s=e;s.Debug&&function(e){var a,u,s,l;for(u in l=["server","auth","dataset","minLength","delay","input","outputlines","output","detail","extra","success","LabelFormat","ReserveOrganisationLine","IncludeCounty","DropCountyToFitLabel","TownFormat","FCC","CUST","ShowBarcodeError","overrideWriteOutputs","overrideParam","failureCallback","jwt","jwtFailureCallback","Debug"],e)if(-1===l.indexOf(u))return void r(e,"Configuration Error","Property '"+u+"' is not supported");if(e.auth&&0!==e.auth.length||e.jwt&&0!==e.jwt.length)if(e.dataset&&0!==e.dataset.length)if(void 0===e.minLength||i(e.minLength))if(void 0===e.delay||i(e.delay))if(e.input&&document.getElementById(e.input))if(void 0!==e.outputlines&&(!i(e.outputlines)||e.outputlines<2||e.outputlines>9))r(e,"Configuration Error","Please provide a valid integer value for 'outputLines'; allowed range 2 to 9");else if(numOutputLines=void 0!==e.outputlines?e.outputlines:7,e.output){for(u in l=["line1","line2","line3","line4","line5","line6","line7","line8","line9","country"],e.output)if(-1===l.indexOf(u))return void r(e,"Configuration Error","Property 'output."+u+"' is not supported");for(a=1;a<=numOutputLines;a++)if(!e.output["line"+a]||!document.getElementById(e.output["line"+a]))return void r(e,"Configuration Error","Please provide a valid field mapping for 'output.line"+a+"'");!e.country||document.getElementById(e.country)?e.success&&"function"!=typeof e.success?r(e,"Configuration Error","Please provide a valid function for 'success'"):e.LabelFormat&&-1===(l=["Standard","FixedPostcode","FixedTown"]).indexOf(e.LabelFormat)?r(e,"Configuration Error","Please provide a valid value for 'LabelFormat'"):e.ReserveOrganisationLine&&-1===(l=["Always","Never","AsRequired"]).indexOf(e.ReserveOrganisationLine)?r(e,"Configuration Error","Please provide a valid value for 'ReserveOrganisationLine'"):e.IncludeCounty&&-1===(l=["Always","Never","AsRequired"]).indexOf(e.IncludeCounty)?r(e,"Configuration Error","Please provide a valid value for 'IncludeCounty'"):e.DropCountyToFitLabel&&-1===(l=["Never","Always"]).indexOf(e.DropCountyToFitLabel)?r(e,"Configuration Error","Please provide a valid value for 'DropCountyToFitLabel'"):e.TownFormat&&-1===(l=["Uppercase","Lowercase"]).indexOf(e.TownFormat)?r(e,"Configuration Error","Please provide a valid value for 'TownFormat'"):((s=t(e.server+"/autoc/json/"+e.dataset+"?q=ListOutputs",n(e))).onload=function(){var t,n,a,i,u=[],l=[];if(401===s.status&&e.jwt&&"function"==typeof e.jwtFailureCallback)e.jwtFailureCallback();else try{if("OK"!==(a=JSON.parse(s.responseText)).Status)return void r(e,a.Status,a.StatusDetails.Description);for(t=0;t<a.Results.Outputs.length;t++)"Address Fields"===(i=a.Results.Outputs[t].TableName)||"Data"===i?u.push(a.Results.Outputs[t].Name):"Extra Data"===i&&l.push(a.Results.Outputs[t].Name);if(e.detail)for(n in e.detail){if(-1===u.indexOf(n))return void r(e,"Configuration Error","Dataset does not support the field 'detail."+n+"''");if(!document.getElementById(e.detail[n]))return void r(e,"Configuration Error","Please provide a valid field mapping for 'detail."+n+"'")}if(e.extra)for(n in e.extra){if(-1===l.indexOf(n))return void r(e,"Configuration Error","Dataset does not support the field 'extra."+n+"''");if(!document.getElementById(e.extra[n]))return void r(e,"Configuration Error","Please provide a valid field mapping for 'extra."+n+"'")}}catch(t){r(e,"Response Error","Failed to process List Outputs response",o(s.responseText))}},s.onerror=function(){r(e,"HTTP Request Error","Error processing List Outputs request.")},s.ontimeout=function(){r(e,"HTTP Request Timeout","List Outputs request timed out.")},s.send()):r(e,"Configuration Error","Please provide a valid field mapping for 'output.country'")}else r(e,"Configuration Error","Please provide valid 'output' field mappings");else r(e,"Configuration Error","Please provide a valid field mapping for 'input'");else r(e,"Configuration Error","Please provide a valid integer value for 'delay'");else r(e,"Configuration Error","Please provide a valid integer value for 'minLength'");else r(e,"Configuration Error","Please provide a value for 'dataset'");else r(e,"Configuration Error","Please provide a value for 'auth'")}(s),s.server&&0!==s.server.length||(s.server="https://cloud.hopewiser.com"),(!i(s.outputlines)||s.outputlines<2||s.outputlines>9)&&(s.outputlines=7),jQuery(function(){jQuery("#"+s.input).autocomplete({source:function(e,a){var i=t(function(e,t){var r,o;if(-1===t.indexOf("%24%40sid%5E")&&(t=encodeURIComponent(t)),o=e.server+"/autoc/json/"+encodeURIComponent(e.dataset)+"?q="+t,o+="&OutputFields=Label"+e.outputlines,e.output.country&&document.getElementById(e.output.country)&&(o+=",Country"),e.detail)for(r in e.detail)o+=","+r;if(e.extra)for(r in e.extra)o+=","+r;return"FixedPostcode"===e.LabelFormat?o+="&LabelFormat=FixedPostcode":"FixedTown"===e.LabelFormat?o+="&LabelFormat=FixedTown":o+="&LabelFormat=Standard","Always"===e.ReserveOrganisationLine?o+="&ReserveOrganisationLine=Always":"Never"===e.ReserveOrganisationLine?o+="&ReserveOrganisationLine=Never":o+="&ReserveOrganisationLine=AsRequired","Always"===e.IncludeCounty?o+="&IncludeCounty=Always":"Never"===e.IncludeCounty?o+="&IncludeCounty=Never":o+="&IncludeCounty=AsRequired","Always"===e.DropCountyToFitLabel?o+="&DropCountyToFitLabel=Always":o+="&DropCountyToFitLabel=Never","Lowercase"===e.TownFormat?o+="&TownFormat=Lowercase":o+="&TownFormat=Uppercase",e.FCC&&(o+="&FCC="+e.FCC),e.CUST&&(o+="&CUST="+e.CUST),e.ShowBarcodeError&&(o+="&ShowBarcodeError="+e.ShowBarcodeError),o}(s,String(e.term)),n(s));i.onload=function(){var e,t,n,l,d=[];if(401===i.status&&s.jwt&&"function"==typeof s.jwtFailureCallback)s.jwtFailureCallback();else{try{switch((l=JSON.parse(i.responseText)).Status){case"NO_MATCH":break;case"OK":for(n=l.Results.Items.length,e=0;e<n;e++)(t=l.Results.Items[e]).IsExpandable?d.push({label:t.ItemText,value:t.Sid,expandsTo:t.ExpandsTo}):d.push({label:t.ItemText,value:t.Sid}),t.Selected&&("function"==typeof s.overrideWriteOutputs?s.overrideWriteOutputs(s,t,u,s.overrideParam):u(s,t),jQuery("#"+s.input).autocomplete("close"),"function"==typeof s.success&&s.success());break;default:"function"==typeof s.failureCallback?s.failureCallback(s,l):r(s,l.Status,l.StatusDetails.Description)}}catch(e){r(s,"Response error","Failed to process Capture response",o(i.responseText))}a(d)}},i.onerror=function(){r(s,"HTTP Request Error","Error processing Address Capture request."),a(items)},i.ontimeout=function(){r(s,"HTTP Request Timeout","Address Capture request timed out."),a(items)},i.send()},minLength:i(s.minLength)?s.minLength:1,delay:i(s.delay)?s.delay:300,focus:function(){return!1},select:function(e,t){return a=t.item.value,!1},close:function(){jQuery("#"+s.input).autocomplete("search",a),a=""}}).autocomplete("instance")._renderItem=function(e,t){return void 0!==t.expandsTo?jQuery("<li>").append("<div>"+t.label+"... <i>("+t.expandsTo+" more)</i></div>").appendTo(e):jQuery("<li>").append("<div>"+t.label+"</div>").appendTo(e)}})}}();