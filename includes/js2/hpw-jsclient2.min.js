document.writeln("\x3c!-- Modal --\x3e"),document.writeln('<div class="modal" id="hpwModal" tabindex="-1" role="dialog" aria-labelledby="hpwModalLabel" aria-hidden="true">'),document.writeln('  <div class="modal-dialog">'),document.writeln('    <div class="modal-content">'),document.writeln('      <div class="modal-header">'),document.writeln('        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),document.writeln('        <h4 class="modal-title hpw-h4" id="hpwModalLabel">Possible Matches</h4>'),document.writeln("      </div>"),document.writeln('      <div class="modal-body">'),document.writeln('        <div class="form-group">'),document.writeln('          <p class="hpw-info" id="hpw-drillDownInfo"></p>'),document.writeln('          <p class="hpw-info" id="hpw-status"></p>'),document.writeln("        </div>"),document.writeln('        <div class="form-group">'),document.writeln('          <select id="hpw-possibles" name="possibles" size="8" class="form-control" ondblclick="HPW.btnOK_onclick()" onkeypress="HPW.selPossibles_onkeypress(event)">'),document.writeln("          </select>"),document.writeln("        </div>"),document.writeln("      </div>"),document.writeln('      <div class="modal-footer">'),document.writeln('        <button type="button" class="btn btn-primary" id="hpw-btnOK" onclick="HPW.btnOK_onclick()">Select</button>'),document.writeln('        <button type="button" class="btn btn-default" onblur="HPW.resetdrillDownDesc()" data-dismiss="modal">Cancel</button>'),document.writeln("      </div>"),document.writeln("    </div>"),document.writeln("  </div>"),document.writeln("</div>"),this.HPW||(this.HPW={}),function(){var e,t,n;function o(e,t,n){return e==t?(o=document.getElementById(e).value,(u=n)&&u.length>0&&(o.length>0&&(o+="\n"),o+=u),o):n;var o,u}function u(u){var r;document.getElementById("hpw-btnOK").disabled=!0,document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML="Looking up address...",document.getElementById("hpw-possibles").innerHTML="",(r=function(e,t){var n=new XMLHttpRequest;return n.open("GET",e),n.timeout=5e3,n.withCredentials=!0,n.setRequestHeader("Authorization","Basic "+t),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("HPW-AuthError","400"),n}(function(t){var n,o,u;if(u=e.server+"/atlaslive/json/"+encodeURIComponent(e.dataset)+"?q="+t,n=5,e.output.line3&&document.getElementById(e.output.line3)&&n++,e.output.line4&&document.getElementById(e.output.line4)&&n++,u+="&OutputFields=Label"+n,e.output.country&&document.getElementById(e.output.country)&&(u+=",Country"),e.detail)for(o in e.detail)u+=","+o;if(e.extra)for(o in e.extra)u+=","+o;return"Always"===e.ReserveOrganisationLine?u+="&ReserveOrganisationLine=Always":"Never"===e.ReserveOrganisationLine?u+="&ReserveOrganisationLine=Never":"AsRequired"===e.ReserveOrganisationLine?u+="&ReserveOrganisationLine=AsRequired":void 0!==e.organisation&&0==e.organisation?u+="&ReserveOrganisationLine=Never":u+="&ReserveOrganisationLine=AsRequired","Lowercase"===e.TownFormat?u+="&TownFormat=Lowercase":u+="&TownFormat=Uppercase","Never"===e.IncludeCounty?u+="&IncludeCounty=Never":"Always"===e.IncludeCounty?u+="&IncludeCounty=Always":u+="&IncludeCounty=AsRequired",u+="&StreetsOverMultipleDistricts=NoSeparation",u+="&PostcodeInPicklist=Include",u+="&PostcodeResultLevel=Premise",u+="&LabelFormat=FixedTown",e.FCC&&(u+="&FCC="+e.FCC),e.CUST&&(u+="&CUST="+e.CUST),e.ShowBarcodeError&&(u+="&ShowBarcodeError="+e.ShowBarcodeError),u}(u),e.auth)).onload=function(){var u,i,a,d;i=""+document.getElementById("hpw-drillDownInfo").innerHTML,document.getElementById("hpw-drillDownInfo").innerHTML=0===i.length?"Searching for "+n:i+"<br/>&nbsp;&nbsp;&nbsp;"+n;try{switch((t=JSON.parse(r.responseText)).Status){case"NO_MATCH":document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML="No match found.";break;case"OK":if(1==(a=t.Results.Items.length)&&t.Results.Items[0].Selected)!function(t){var n,u,r;document.getElementById(e.output.line1).value=l(t.Label1),document.getElementById(e.output.line2).value=o(e.output.line2,e.output.line1,l(t.Label2)),u=e.output.line2,n=3,e.output.line3&&document.getElementById(e.output.line3)&&(document.getElementById(e.output.line3).value=o(e.output.line3,u,l(t["Label"+n])),u=e.output.line3,n++);e.output.line4&&document.getElementById(e.output.line4)&&(document.getElementById(e.output.line4).value=o(e.output.line4,u,l(t["Label"+n])),u=e.output.line4,n++);document.getElementById(e.output.town).value=o(e.output.town,u,l(t["Label"+n])),u=e.output.town,n++,e.output.county&&document.getElementById(e.output.county)&&(document.getElementById(e.output.county).value=o(e.output.county,u,l(t["Label"+n])),u=e.output.county);n++,document.getElementById(e.output.postcode).value=o(e.output.postcode,u,l(t["Label"+n])),u=e.output.postcode,n++,e.output.country&&document.getElementById(e.output.country)&&(document.getElementById(e.output.country).value=o(e.output.country,u,l(t.Country)));if(e.detail)for(var i in e.detail)document.getElementById(e.detail[i])&&(t[i]?document.getElementById(e.detail[i]).value=t[i]:document.getElementById(e.detail[i]).value="");if(e.extra&&t.Extra&&t.Extra.Records&&t.Extra.Records.length>0)for(var i in r=t.Extra.Records[0],e.extra)document.getElementById(e.extra[i])&&(r[i]?document.getElementById(e.extra[i]).value=r[i]:document.getElementById(e.extra[i]).value="")}(t.Results.Items[0]),jQuery("#hpwModal").modal("hide"),HPW.resetdrillDownDesc(),"function"==typeof e.success&&e.success();else{for(document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML=a+(a>1?" possible matches found.":" match found."),document.getElementById("hpw-possibles").innerHTML="",u=0;u<a;u++)(d=document.createElement("option")).value=u,d.text=t.Results.Items[u].ItemText.replace(/,/g,", "),document.getElementById("hpw-possibles").options.add(d);document.getElementById("hpw-possibles").length>0&&(document.getElementById("hpw-possibles").selectedIndex=0,document.getElementById("hpw-possibles").focus(),document.getElementById("hpw-btnOK").disabled=!1,n=document.getElementById("hpw-possibles")[0].text)}break;default:document.getElementById("hpw-status").className="hpw-error",document.getElementById("hpw-status").innerHTML=e.Debug?t.StatusDetails.Description:"The address capture feature is currently unavailable"}}catch(t){document.getElementById("hpw-status").className="hpw-error",document.getElementById("hpw-status").innerHTML=e.Debug?"Failed to process Capture response:<br/>"+r.responseText.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;"):"The address capture feature is currently unavailable"}},r.onerror=function(){document.getElementById("hpw-status").className="hpw-error",document.getElementById("hpw-status").innerHTML=e.Debug?"Error processing address capture request":"The address capture feature is currently unavailable"},r.ontimeout=function(){document.getElementById("hpw-status").className="hpw-error",document.getElementById("hpw-status").innerHTML=e.Debug?"Address capture request timed out":"The address capture feature is currently unavailable"},r.send()}function l(e){return void 0!==e?e:""}HPW.selPossibles_onkeypress=function(e){13!=(e.charCode?e.charCode:e.keyCode)||document.getElementById("hpw-btnOK").disabled||HPW.btnOK_onclick()},HPW.btnOK_onclick=function(){var e=document.getElementById("hpw-possibles").selectedIndex;n=document.getElementById("hpw-possibles")[e].text,u(t.Results.Items[document.getElementById("hpw-possibles").value].Sid)},HPW.resetdrillDownDesc=function(){n="",document.getElementById("hpw-drillDownInfo").innerHTML=""},HPW.FindAddress=function(t){var o,r,i,a,d;if(!(e=t).Debug||function(){var t,n,o,u;for(n in u=["auth","CUST","dataset","Debug","detail","extra","FCC","IncludeCounty","input","output","organisation","ReserveOrganisationLine","server","ShowBarcodeError","success","TownFormat"],e)if(-1===u.indexOf(n))return void alert("Property '"+n+"' is not supported");if(!e.auth||0===e.auth.length)return alert("Please provide a value for 'auth'"),!1;if(!e.dataset||0==e.dataset.length)return alert("Please provide a value for 'dataset'"),!1;if(!e.input||!document.getElementById(e.input)){try{o=e.input.split(",")}catch(e){return alert("Error detected in 'input' definition"),!1}for(t=0;t<o.length;t++)if(!document.getElementById(o[t])&&o[t].length>0)return alert("Input field '"+o[t]+"' is not valid"),!1}if(e.output){for(n in u=["line1","line2","line3","line4","town","county","postcode","country"],e.output)if(-1===u.indexOf(n))return void alert("Property 'output."+n+"' is not supported");if(!e.output.line1||!document.getElementById(e.output.line1))return alert("Please provide a valid field mapping for 'output.line1'"),!1;if(!e.output.line2||!document.getElementById(e.output.line2))return alert("Please provide a valid field mapping for 'output.line2'"),!1;if(e.output.line3&&!document.getElementById(e.output.line3))return alert("Please provide a valid field mapping for 'output.line3'"),!1;if(e.output.line4&&!document.getElementById(e.output.line4))return alert("Please provide a valid field mapping for 'output.line4'"),!1;if(!e.output.town||!document.getElementById(e.output.town))return alert("Please provide a valid field mapping for 'output.town'"),!1;if(e.output.county&&!document.getElementById(e.output.county))return alert("Please provide a valid field mapping for 'output.county'"),!1;if(!e.output.postcode||!document.getElementById(e.output.postcode))return alert("Please provide a valid field mapping for 'output.postcode'"),!1;if(e.output.country&&!document.getElementById(e.output.country))return alert("Please provide a valid field mapping for 'output.country'"),!1;if(e.detail)for(n in e.detail)if(!document.getElementById(e.detail[n]))return alert("Please provide a valid field mapping for 'detail."+n+"'"),!1;if(e.extra)for(n in e.extra)if(!document.getElementById(e.extra[n]))return alert("Please provide a valid field mapping for 'extra."+n+"'"),!1;return e.IncludeCounty&&-1===(u=["Always","Never","AsRequired"]).indexOf(e.IncludeCounty)?(alert("Please provide a valid value for 'IncludeCounty'"),!1):void 0!==e.organisation&&"boolean"!=typeof e.organisation?(alert("The provided 'organisation' value is invalid. The parameter has also been deprecated in preference of 'ReserveOrganisationLine'"),!1):e.ReserveOrganisationLine&&-1===(u=["Always","Never","AsRequired"]).indexOf(e.ReserveOrganisationLine)?(alert("Please provide a valid value for 'ReserveOrganisationLine'"),!1):e.TownFormat&&-1===(u=["Lowercase","Uppercase"]).indexOf(e.TownFormat)?(alert("Please provide a valid value for 'TownFormat'"),!1):!e.success||"function"==typeof e.success||(alert("Please provide a valid function for 'success'"),!1)}alert("Please provide valid 'output' field mappings")}())for(e.server&&0!==e.server.length||(e.server="https://cloud.hopewiser.com"),r="",a=e.input.split(","),o=0;o<a.length;o++)(i=document.getElementById(a[o]))&&(d=l(i.value).trim()).length>0&&(0===r.length?r=d:r+=","+d);if(n=r,0===(r=(r=r.replace(/\n/g,",")).replace(/\r/g,",")).length)return document.getElementById("hpw-btnOK").disabled=!0,document.getElementById("hpw-possibles").innerHTML="",document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML="Please enter search criteria.",HPW.resetdrillDownDesc(),!1;-1==r.indexOf("@")&&-1==r.indexOf(",")&&-1==r.indexOf("*")&&-1==r.indexOf("?")&&(r+="@A"),u(encodeURIComponent(r))}}();