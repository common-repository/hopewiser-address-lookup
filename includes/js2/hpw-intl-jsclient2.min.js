document.writeln("\x3c!-- Modal --\x3e"),document.writeln('<div class="modal" id="hpwModal" tabindex="-1" role="dialog" aria-labelledby="hpwModalLabel" aria-hidden="true">'),document.writeln('  <div class="modal-dialog">'),document.writeln('    <div class="modal-content">'),document.writeln('      <div class="modal-header">'),document.writeln('        <button type="button" class="close" data-dismiss="modal" aria-hidden="true">&times;</button>'),document.writeln('        <h4 class="modal-title hpw-h4" id="hpwModalLabel">Possible Matches</h4>'),document.writeln("      </div>"),document.writeln('      <div class="modal-body">'),document.writeln('        <div class="form-group">'),document.writeln('          <p class="hpw-info" id="hpw-drillDownInfo"></p>'),document.writeln('          <p class="hpw-info" id="hpw-status"></p>'),document.writeln("        </div>"),document.writeln('        <div class="form-group">'),document.writeln('          <select id="hpw-possibles" name="possibles" size="8" class="form-control" ondblclick="HPWINTL.btnOK_onclick()" onkeypress="HPWINTL.selPossibles_onkeypress(event)">'),document.writeln("          </select>"),document.writeln("        </div>"),document.writeln("      </div>"),document.writeln('      <div class="modal-footer">'),document.writeln('        <button type="button" class="btn btn-primary" id="hpw-btnOK" onclick="HPWINTL.btnOK_onclick()">Select</button>'),document.writeln('        <button type="button" class="btn btn-default" id="hpw-btnCancel" onblur="HPWINTL.resetdrillDownDesc()" data-dismiss="modal">Cancel</button>'),document.writeln("      </div>"),document.writeln("    </div>"),document.writeln("  </div>"),document.writeln("</div>"),this.HPWINTL||(this.HPWINTL={},this.HPWINTL.ADDRESS_SEARCH=0,this.HPWINTL.USE_OWN_CODES=1,this.HPWINTL.USE_ALPHA2_CODES=2,this.HPWINTL.USE_ALPHA3_CODES=3),function(){var e=null,t=null,n="",o="",r="",i=[],s=[],l=!1,d=null,u=HPWINTL.ADDRESS_SEARCH;function a(e){var n,o,r;if((o=e.toUpperCase()).length>4&&"TOP-"===o.substr(0,4)&&(o=o.substr(4)),d)for(n=0;n<d.length;n++)if(d[n].Code3===o||d[n].Code2===o)return d[n].Code3;return"object"==typeof(r=t.aliasCountryCodes)&&null!==r&&!Array.isArray(r)&&o in t.aliasCountryCodes?t.aliasCountryCodes[o]:""}function c(e,t){var n=new XMLHttpRequest;return n.open("GET",e),n.timeout=5e3,n.withCredentials=!0,n.setRequestHeader("Authorization","Basic "+t),n.setRequestHeader("Content-Type","application/json"),n.setRequestHeader("HPW-AuthError","400"),n}function p(e,n){var o;o=t.Debug?n?e+"<br><br>"+n:e:"The address capture feature is currently unavailable.",document.getElementById("hpwModalLabel").textContent="International JavaScript Client",document.getElementById("hpw-status").className="hpw-error",document.getElementById("hpw-status").innerHTML=o,document.getElementById("hpw-possibles").hidden=!0,document.getElementById("hpw-btnOK").hidden=!0,document.getElementById("hpw-btnCancel").textContent="Close",jQuery("#hpwModal").modal("show")}function m(e,n){var o;t.Debug&&(o=n?e+"<br><br>"+n:e,document.getElementById("hpwModalLabel").textContent="International JavaScript Client",document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML=o,document.getElementById("hpw-possibles").hidden=!0,document.getElementById("hpw-btnOK").hidden=!0,document.getElementById("hpw-btnCancel").textContent="Close",jQuery("#hpwModal").modal("show"))}function g(i){var s,l,d;document.getElementById("hpw-btnOK").disabled=!0,document.getElementById("hpw-btnOK").hidden=!1,document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML="Looking up address...",document.getElementById("hpwModalLabel").innerHTML="Possible Matches",document.getElementById("hpw-btnCancel").textContent="Cancel",document.getElementById("hpw-possibles").innerHTML="",document.getElementById("hpw-possibles").hidden=!1,l="",n="",o="",t.countryListBox&&(s=document.getElementById(t.countryListBox))&&(o=I(s),l=s.value,n=a(l)),""!==n?((d=c(function(e){var o,r;if(r=t.server+"/atlaslive/json/international?country="+n+"&q="+e,r+="&OutputFields=Label7",t.output.country&&document.getElementById(t.output.country)&&(r+=",Country"),t.detail)for(o in t.detail)r+=","+o;if(t.extra)for(o in t.extra)r+=","+o;return r+="&LabelFormat=Standard"}(i),t.auth)).onload=function(){var i,s,l,u;s=""+document.getElementById("hpw-drillDownInfo").innerHTML,document.getElementById("hpw-drillDownInfo").innerHTML=0===s.length?"Searching address in "+o+" for<br/>&nbsp;&nbsp;&nbsp;"+r:s+"<br/>&nbsp;&nbsp;&nbsp;"+r;try{switch((e=JSON.parse(d.responseText)).Status){case"NO_MATCH":document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML="No match found.";break;case"OK":if(1===(l=e.Results.Items.length)&&e.Results.Items[0].Selected)!function(e){var n,o,r,i,s;for(n=1;n<=7;n++)(r=t.output["line"+n])&&document.getElementById(r)&&(document.getElementById(r).value=(l=r,d=i,u=h(e["Label"+n]),a=void 0,c=void 0,l===d?(a=document.getElementById(l).value,(c=u)&&c.length>0?a.length>0?a+"\n"+c:a+c:a):u),i=r);var l,d,u,a,c;if(t.detail)for(o in t.detail)document.getElementById(t.detail[o])&&(e[o]?document.getElementById(t.detail[o]).value=e[o]:document.getElementById(t.detail[o]).value="");if(t.extra&&e.Extra&&e.Extra.Records&&e.Extra.Records.length>0)for(o in s=e.Extra.Records[0],t.extra)document.getElementById(t.extra[o])&&(s[o]?document.getElementById(t.extra[o]).value=s[o]:document.getElementById(t.extra[o]).value="")}(e.Results.Items[0]),jQuery("#hpwModal").modal("hide"),HPWINTL.resetdrillDownDesc(),"function"==typeof t.success&&t.success();else{for(document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML=l.toString()+(l>1?" possible matches found.":" match found."),document.getElementById("hpw-possibles").innerHTML="",i=0;i<l;i++)(u=document.createElement("option")).value=i,u.text=e.Results.Items[i].ItemText.replace(/,/g,", "),document.getElementById("hpw-possibles").options.add(u);document.getElementById("hpw-possibles").length>0&&(document.getElementById("hpw-possibles").selectedIndex=0,document.getElementById("hpw-possibles").focus(),document.getElementById("hpw-btnOK").disabled=!1,r=document.getElementById("hpw-possibles")[0].text)}break;default:"Country not supported by the International MAF"===e.StatusDetails.Description?p(e.StatusDetails.Description,"<br>"+n+" country code not recognised"):p(e.StatusDetails.Description)}}catch(e){p("Failed to process Capture response",f(d.responseText))}},d.onerror=function(){p("Error processing address capture request")},d.ontimeout=function(){p("Error processing address capture request")},d.send()):p("Country code '"+l+"' is not recognised for "+o)}function f(e){return e.replace(/&/g,"&amp;").replace(/</g,"&lt;").replace(/>/g,"&gt;").replace(/"/g,"&quot;").replace(/'/g,"&#039;")}function h(e){return void 0!==e?e:""}function y(e){var t,n,o;try{for(t=0;t<document.styleSheets.length;t++)for(o=document.styleSheets[t],n=0;n<o.cssRules.length;n++)if(o.cssRules[n].selectorText==="."+e)return!0}catch(e){}return!1}function E(){var e;u===HPWINTL.USE_OWN_CODES||t.countryListBox&&document.getElementById(t.countryListBox)?(void 0===t.server&&(t.server="https://cloud.hopewiser.com"),(e=c(t.server+"/atlaslive/countries/json",t.auth)).onload=function(){var o,r,c,g,h,E;try{if("OK"===(h=JSON.parse(e.responseText)).Status){if(d=h.Results.Countries,u!==HPWINTL.USE_OWN_CODES){for(E="","text"===(c=document.getElementById(t.countryListBox)).type?(E=c.value,c.outerHTML='<select id="'+t.countryListBox+'"></select>',c=document.getElementById(t.countryListBox)):"select-one"===c.type&&(-1!==c.selectedIndex&&(E=c.options[c.selectedIndex].value),c.outerHTML='<select id="'+t.countryListBox+'"></select>');c.length>0;)c.remove(0);if(jQuery("#"+t.countryListBox).change(function(){var e,n,o,r;o=document.getElementById(t.countryListBox),r="",o&&(r=o.value.toUpperCase()).length>4&&"TOP-"===r.substr(0,4)&&(r=r.substr(4)),""!==(e=a(r))&&(0===i.length||-1!==(n=i.indexOf(e))&&"None"!==s[n]&&"City"!==s[n])?document.getElementById("btnFindAddress").disabled=!1:document.getElementById("btnFindAddress").disabled=!0}),function(){var e,o,r,l,u,c;if((l=document.getElementById(t.countryListBox))&&void 0!==t.topCountries){for(c=t.topCountries.toUpperCase().split(","),e=0;e<c.length;e++)if(""!==(n=c[e].toUpperCase())){if((u=document.createElement("option")).value="TOP-"+n,u.id="hpwintl-"+u.value,i.push(u.value),s.push("None"),y("hpwintl-"+n)?u.className="hpwintl-"+n:u.className="hpwintl-top-countries",""!==(o=a(n))){if(r="unknown",d)for(var p=0;p<d.length;p++)if(d[p].Code3===o){r=d[p].Name;break}}else r="Country code '"+n+"' not recognised";u.text=r,l.options.add(u)}(u=document.createElement("option")).value="hpwintl-divider",u.id="hpwintl-divider",u.className="hpwintl-separator",u.text="-------------------------------",u.disabled=!1,l.options.add(u)}}(),c=document.getElementById(t.countryListBox),d)for(o=0;o<d.length;o++)(g=document.createElement("option")).value=u===HPWINTL.USE_ALPHA2_CODES?d[o].Code2:d[o].Code3,g.id="hpwintl-"+g.value,g.text=d[o].Name,i.push(d[o].Code3),s.push(d[o].CoverageLevel),"None"===d[o].CoverageLevel||"City"===d[o].CoverageLevel?g.className="hpwintl-disabled-countries":y(g.id)?g.className=g.id:g.className="hpwintl-other-countries",c.options.add(g);!function(){var e,t,n,o;for(e=0;e<i.length&&(i[e].length>4&&"TOP-"===i[e].substr(0,4));e++)n=i[e].substr(4),-1!==(t=i.indexOf(n))&&(o=s[t],s[e]=o,"None"!==o&&"City"!==o||(document.getElementById("hpwintl-TOP-"+n).className="hpwintl-disabled-countries"))}(),""!==E&&""!==(r=a(E))&&(u===HPWINTL.USE_ALPHA2_CODES?c.value=function(e,t){var n;if(d)for(n=0;n<d.length;n++)if(d[n].Code3===e)return d[n].Code2;return t}(r,E):c.value=r),l=!0,function(){var e,n,o,r;if(t.topCountries)for(r=t.topCountries.toUpperCase().split(","),e=0;e<r.length;e++)""!==(o=r[e])&&(""===(n=a(o))?m("Country code '"+o+"' is not recognised"):n!==o&&m("Country code '"+o+"' is not recognised. It will be changed to '"+n+"' when performing address lookups"))}()}}else p("Failed to populate country list.",h.StatusDetails.Description)}catch(t){p("Failed to process list countries response.",f(e.responseText))}},e.onerror=function(){p("Error processing list countries request.")},e.ontimeout=function(){p("List countries request timed out")},e.send()):p("Configuration Error:","Please provide a valid mapping for 'countryListBox'")}function I(e){return e.options[e.selectedIndex]?e.options[e.selectedIndex].text:""}HPWINTL.FindAddress=function(e){var n,o,i,s,d;if((u=void 0!==(t=e).Mode?t.Mode:HPWINTL.ADDRESS_SEARCH)!==HPWINTL.ADDRESS_SEARCH)E();else if(u===HPWINTL.ADDRESS_SEARCH&&(!t.Debug||function(){var e,n,o,r,i,s;for(n in s=["aliasCountryCodes","auth","countryListBox","Debug","detail","extra","input","Mode","output","server","success","topCountries"],t)if(-1===s.indexOf(n))return p("Configuration Error:","Property '"+n+"' is not supported"),!1;if(!t.auth||0===t.auth.length)return p("Configuration Error:","Please provide a value for 'auth'"),!1;if(!t.input||!document.getElementById(t.input)){try{i=t.input.split(",")}catch(e){return p("Configuration Error:","Error detected in 'input' definition"),!1}for(e=0;e<i.length;e++)if(!document.getElementById(i[e])&&i[e].length>0)return p("Configuration Error:","Input field '"+i[e]+"' is not valid"),!1}if(!t.output)return p("Configuration Error:","Please provide at least 1 field mapping for 'output'"),!1;for(n in s=["line1","line2","line3","line4","line5","line6","line7","country"])-1===s.indexOf(n)&&p("Configuration Error:","Property 'output."+n+"' is not supported");if(!t.output.line1||!document.getElementById(t.output.line1))return p("Configuration Error:","Please provide a valid mapping for 'output.line1'"),!1;if(t.output.line2&&!document.getElementById(t.output.line2))return p("Configuration Error:","Please provide a valid mapping for 'output.line2'"),!1;if(t.output.line3&&!document.getElementById(t.output.line3))return p("Configuration Error:","Please provide a valid mapping for 'output.line3'"),!1;if(t.output.line4&&!document.getElementById(t.output.line4))return p("Configuration Error:","Please provide a valid mapping for 'output.line4'"),!1;if(t.output.line5&&!document.getElementById(t.output.line5))return p("Configuration Error:","Please provide a valid mapping for 'output.line5'"),!1;if(t.output.line6&&!document.getElementById(t.output.line6))return p("Configuration Error:","Please provide a valid mapping for 'output.line6'"),!1;if(t.output.line7&&!document.getElementById(t.output.line7))return p("Configuration Error:","Please provide a valid mapping for 'output.line7'"),!1;if(t.detail)for(n in t.detail)if(!document.getElementById(t.detail[n]))return p("Configuration Error:","Please provide a valid mapping for 'detail."+n+"'"),!1;if(t.extra)for(n in t.extra)if(!document.getElementById(t.extra[n]))return p("Configuration Error:","Please provide a valid mapping for 'extra."+n+"'"),!1;if(t.success&&"function"!=typeof t.success)return p("Configuration Error:","Please provide a valid function for 'success'"),!1;if(!l){if(!(r=document.getElementById(t.countryListBox)))return p("Configuration Error:","Please provide a valid mapping for 'countryListBox'"),!1;if("select-one"===r.type&&""!==r.value&&""===a(o=r.value.toUpperCase()))return p("Configuration Error:","The country code '"+o+"' is not recognised  for "+I(r)),!1}return!0}())){for(void 0!==t.server&&0!==t.server.length||(t.server="https://cloud.hopewiser.com"),o="",s=t.input.split(","),n=0;n<s.length;n++)(i=document.getElementById(s[n]))&&(d=h(i.value).trim()).length>0&&(0===o.length?o=d:o+=","+d);if(0===(o=(o=o.replace(/\n/g,",")).replace(/\r/g,",")).length)return document.getElementById("hpw-btnOK").disabled=!0,document.getElementById("hpw-possibles").innerHTML="",document.getElementById("hpw-status").className="hpw-info",document.getElementById("hpw-status").innerHTML="Please enter search criteria.",HPWINTL.resetdrillDownDesc(),!1;r=o,g(encodeURIComponent(o))}},HPWINTL.btnOK_onclick=function(){var t=document.getElementById("hpw-possibles").selectedIndex;r=document.getElementById("hpw-possibles")[t].text,g(e.Results.Items[document.getElementById("hpw-possibles").value].Sid)},HPWINTL.resetdrillDownDesc=function(){r="",document.getElementById("hpw-drillDownInfo").innerHTML=""},HPWINTL.selPossibles_onkeypress=function(e){13!==(e.charCode?e.charCode:e.keyCode)||document.getElementById("hpw-btnOK").disabled||HPWINTL.btnOK_onclick()}}();